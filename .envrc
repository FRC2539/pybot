if [ -z `which pip3 2> /dev/null` ]; then
    echo "pip3 must be installed"
    echo "Aborting..."
    return
fi

# Set up a virtualenv if it doesn't already exist
if [ ! -d $PWD/.venv ]; then
    if [ -z `which virtualenv 2> /dev/null` ]; then
        while true; do
            read -p "You do not have virtualenv installed. Should I install it using pip? " yn
            case $yn in
                [Yy]* ) sudo pip3 install virtualenv; break;;
                [Nn]* ) echo "Please install virtualenv"; return;;
                * ) echo "Answer yes or no";;
            esac
        done
    fi

    virtualenv -p python3 --no-site-packages $PWD/.venv
    $PWD/.venv/bin/pip install -r $PWD/requirements.txt

    if [ ! -d $PWD/tests ]; then
        $PWD/robot.py add-tests 2> /dev/null
    fi

    ln -s $PWD/hooks/* $PWD/.git/hooks/
fi

export PATH=$PWD/.venv/bin:$PATH
(pip install -U -r $PWD/requirements.txt > /dev/null &)
